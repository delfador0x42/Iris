import Foundation

/// Known malicious persistence labels from 214 malware family analysis.
/// Each label was extracted from real malware samples.
public enum MalwarePersistence {

    public static func indicators() -> [ThreatIndicator] {
        labels.map { entry in
            ThreatIndicator(
                type: .persistenceLabel,
                value: entry.label,
                malwareFamily: entry.family,
                mitreId: "T1543",
                severity: .critical
            )
        }
    }

    private struct Entry { let label: String; let family: String }

    private static let labels: [Entry] = [
        // CookieMiner
        Entry(label: "com.apple.rig2", family: "CookieMiner"),
        Entry(label: "com.proxy.initialize", family: "CookieMiner"),
        // BirdMiner
        Entry(label: "com.unshavedly", family: "BirdMiner"),
        Entry(label: "com.woolgrowing", family: "BirdMiner"),
        // OSAMiner
        Entry(label: "com.apple.FY9", family: "OSAMiner"),
        // Eleanor
        Entry(label: "com.getdropbox.dropbox.timegrabber", family: "Eleanor"),
        // Pwnet
        Entry(label: "com.dynamsoft.WebTwainService", family: "Pwnet"),
        // CloudMensis
        Entry(label: ".com.apple.WindowServer", family: "CloudMensis"),
        Entry(label: ".com.apple.softwareupdate", family: "CloudMensis"),
        // Calisto
        Entry(label: "com.proton.calisto", family: "Calisto"),
        // ChillyHell
        Entry(label: "com.example.www", family: "ChillyHell"),
        Entry(label: "com.apple.qtop", family: "ChillyHell"),
        Entry(label: "com.finder.helper", family: "ChillyHell"),
        // Activator
        Entry(label: "launched.", family: "Activator"),
        // iWebUpdate
        Entry(label: "com.apple.iWebUpdate", family: "iWebUpdate"),
        // Genieo
        Entry(label: "com.genieoinnovation", family: "Genieo"),
        Entry(label: "com.genieo", family: "Genieo"),
        // Fruitfly
        Entry(label: "com.client.client", family: "Fruitfly"),
        // DazzleSpy
        Entry(label: "com.apple.softwareupdate", family: "DazzleSpy"),
        // Dacls
        Entry(label: "com.apple.updates.ntp", family: "Dacls"),
        // Empyre
        Entry(label: "com.apple.systemkeeper", family: "Empyre"),
        // ModStealer
        Entry(label: "com.apple.system.session", family: "ModStealer"),
        // Proton
        Entry(label: "com.Eltima.UpdaterAgent", family: "Proton"),
        // WindTail
        Entry(label: "com.apple.loginItemHelper", family: "WindTail"),
        // Yort
        Entry(label: "com.apple.Safari.proxy", family: "Yort"),
        // DarthMiner
        Entry(label: "com.apple.ProtectedCloudStorage", family: "DarthMiner"),
        // AdLoad
        Entry(label: "com.apple.service.agentupd", family: "AdLoad"),
        Entry(label: "com.apple.service.agent", family: "AdLoad"),
        // Bundlore
        Entry(label: "com.macpaw.CleanMyMac", family: "Bundlore"),
        // Shlayer
        Entry(label: "com.apple.systemmond", family: "Shlayer"),
        // OceanLotus (APT32)
        Entry(label: "com.apple.screen.assistantd", family: "OceanLotus"),
        Entry(label: "com.apple.inter.net", family: "OceanLotus"),
        // Xagent (APT28)
        Entry(label: "com.apple.updates.agent", family: "Xagent"),
        // FlexibleFerret (DPRK)
        Entry(label: "com.apple.secd", family: "FlexibleFerret"),
        // RustDoor (ALPHV)
        Entry(label: "com.apple.visualstudioupdate", family: "RustDoor"),
        // EvilQuest
        Entry(label: "com.apple.questd", family: "EvilQuest"),
        // NukeSped (DPRK)
        Entry(label: "com.apple.ntp.assist", family: "NukeSped"),
        // Siggen
        Entry(label: "com.enzo", family: "Siggen"),
        // WSClient
        Entry(label: "com.r.appe.windowservice", family: "WSClient"),
        // Cuckoo
        Entry(label: "com.apple.usbd", family: "Cuckoo"),
        // SilverSparrow
        Entry(label: "init_verx", family: "SilverSparrow"),
        Entry(label: "com.apple.agentcheck", family: "SilverSparrow"),
        // Mokes
        Entry(label: "com.apple.spotlight.importd", family: "Mokes"),
        // Komplex
        Entry(label: "com.apple.updates.kextd", family: "Komplex"),
    ]
}
